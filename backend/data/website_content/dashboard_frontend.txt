Dashboard Page

}
      <

Admin Dashboard
            <

Welcome {user?.username} ‚Äî manage and analyze your events.
            <

All Categories<

(
                    <

))}
                <

(
                  <

))}
                <

NEW<

ATTENDEES<

Reset
                <

)}
            <

Loading...<

}
          {error && (
            <

)}

          <

Events
              <

Upcoming
              <

Attendees
              <

Your Events<

You haven't created any events yet.
              <

) : (
              <

Title<

Date<

Location<

Attendees<

Actions<

(
                        <

(
                          <

edit<

delete<

))}
                  <

perPage && (
                  <

Show
                        <

(
                            <

))}
                        <

Prev
                    <

(
                        <

))}
                    <

Page {currentPage + 1} /{" "}
                      {Math.ceil(filteredEvents.length / perPage)}
                    <

Next <

)}
              <

)}
          <

Confirm delete<

Are you sure you want to delete this event? This action cannot be
              undone.
            <

Cancel
              <

)}
    <

);
  const [stats, setStats] = useState({ total: 0, upcoming: 0, attendees: 0 });
  const [currentPage, setCurrentPage] = useState(0);
  const [perPage, setPerPage] = useState(6);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [pendingDeleteId, setPendingDeleteId] = useState(null);
  const [deleteLoading, setDeleteLoading] = useState(false);
  const [searchQuery, setSearchQuery] = useState(

);
  const [categoryFilter, setCategoryFilter] = useState(

);
  const [minAttendees, setMinAttendees] = useState(

);
  const [sortOption, setSortOption] = useState(

const [sortDir, setSortDir] = useState(

const [filteredEvents, setFilteredEvents] = useState([]);
  const navigate = useNavigate();
  useEffect(() => {
    let mounted = true;

    const load = async () => {
      setLoading(true);
      try {
        const res = await apiService.getEvents();
        if (!res?.data?.success) throw new Error(

);
        // Filter events created by this admin
        const all = res.data.events || [];
        const myEvents = all.filter(
          (ev) =>
            String(ev.createdBy) === String(user?._id) ||
            String(ev.createdBy?._id) === String(user?._id)
        );

        // For each event, fetch attendee count
        // Fetch attendee counts sequentially but could be optimized with backend aggregation
        const counts = [];
        for (const ev of myEvents) {
          try {
            const r = await apiService.getEventRegistrations(ev._id);
            if (r?.data?.success && Array.isArray(r.data.registration)) {
              counts.push({ id: ev._id, count: r.data.registration.length });
            } else counts.push({ id: ev._id, count: 0 });
          } catch {
            // 404 or other => treat as zero attendees
            counts.push({ id: ev._id, count: 0 });
          }
        }

        // attach counts
        const withCounts = myEvents.map((ev) => {
          const match = counts.find((c) => c.id === ev._id);
          // derive a reliable creation timestamp: prefer ev.createdAt; else decode from ObjectId; else fallback to event date
          let derivedCreatedAt = ev.createdAt;
          if (
            !derivedCreatedAt &&
            ev._id &&
            typeof ev._id ===

&&
            ev._id.length >= 8
          ) {
            try {
              const ts = parseInt(ev._id.substring(0, 8), 16) * 1000; // ObjectId timestamp seconds -> ms
              derivedCreatedAt = new Date(ts).toISOString();
            } catch {
              /* ignore */
            }
          }
          if (!derivedCreatedAt && ev.date) derivedCreatedAt = ev.date;
          return {
            ...ev,
            attendees: match ? match.count : 0,
            _createdAt: derivedCreatedAt,
          };
        });

        if (!mounted) return;
        setEvents(withCounts);
        setFilteredEvents(withCounts); // initial

        // compute stats
        const now = Date.now();
        const total = withCounts.length;
        const upcoming = withCounts.filter(
          (ev) => new Date(ev.date).getTime() >= now
        ).length;
        const attendees = withCounts.reduce(
          (s, e) => s + (Number(e.attendees) || 0),
          0
        );
        setStats({ total, upcoming, attendees });
      } catch (e) {
        console.error(e);
        if (mounted) setError(

);
      } finally {
        if (mounted) setLoading(false);
      }
    };

    if (user?.isAdmin) load();

    return () => {
      mounted = false;
    };
  }, [user]);

  // show modal
  const handleDelete = (eventId) => {
    setPendingDeleteId(eventId);
    setShowDeleteModal(true);
  };

  const confirmDelete = async () => {
    if (!pendingDeleteId) return;
    setDeleteLoading(true);
    try {
      await apiService.deleteEvent(pendingDeleteId);
      setEvents((prev) => {
        const updated = prev.filter((e) => e._id !== pendingDeleteId);
        const now = Date.now();
        const total = updated.length;
        const upcoming = updated.filter(
          (ev) => new Date(ev.date).getTime() >= now
        ).length;
        const attendees = updated.reduce(
          (s, e) => s + (Number(e.attendees) || 0),
          0
        );
        setStats({ total, upcoming, attendees });
        return updated;
      });
      setShowDeleteModal(false);
      setPendingDeleteId(null);
      showSuccessToast(

);
    } catch (e) {
      console.error(e);
      setError(

);
      showErrorToast(

);
    } finally {
      setDeleteLoading(false);
    }
  };

  const cancelDelete = () => {
    setPendingDeleteId(null);
    setShowDeleteModal(false);
  };

  // Build category list (unique)
  const categories = Array.from(
    new Set(events.map((e) => e.category).filter(Boolean))
  );

  // Filtering + sorting
  useEffect(() => {
    let list = [...events];
    const q = searchQuery.trim().toLowerCase();
    if (q) list = list.filter((e) => (e.title ||

).toLowerCase().includes(q));
    if (categoryFilter)
      list = list.filter((e) => e.category === categoryFilter);
    if (minAttendees !==

&& !isNaN(minAttendees)) {
      const minA = Number(minAttendees);
      list = list.filter((e) => (e.attendees || 0) >= minA);
    }
    // sort
    // Sorting:

uses _createdAt (injected) or createdAt -> ObjectId derived timestamp -> event date.
    const getCreated = (e) =>
      new Date(
        e._createdAt ||
          e.createdAt ||
          (e._id && typeof e._id ===

&& e._id.length >= 8
            ? parseInt(e._id.substring(0, 8), 16) * 1000
            : e.date || 0)
      );
    const sorter = {
      new: (a, b) => getCreated(a) - getCreated(b),
      attendees: (a, b) => (a.attendees || 0) - (b.attendees || 0),
    }[sortOption];
    if (sorter) list.sort(sorter);
    if (sortDir ===

) list.reverse();
    setFilteredEvents(list);
    setCurrentPage(0); // reset page when filters change
  }, [searchQuery, categoryFilter, minAttendees, sortOption, sortDir, events]);

  const eventAttendee = async (e) => {
    // console.log(e);
    navigate(`/event-attendee/${e}`);
  };

  return (
    <div
      style={{
        minHeight:

,
        display:

,
        flexDirection:

,
        fontFamily:

,
      }}
    >
      {loading && <Loader color={document.documentElement.getAttribute(

} />}
      <Header />
      <main
        className=

style={{ flex: 1, padding:

}}
      >
        <header
          style={{ display:

, flexDirection:

}}
        >
          <div>
            <h1 className=

style={{ margin: 0 }}>
              Admin Dashboard
            </h1>
            <p className=

style={{ margin: 0 }}>
              Welcome {user?.username} ‚Äî manage and analyze your events.
            </p>
          </div>
          {/* Unified styled search / filter bar */}
          <div
            className={`dash-search fx-bar`}
            style={{ padding:

}}
          >
            <div
              className=

style={{ justifyContent:

}}
            >
              {/* Search */}
              <div
                className=

style={{ flex:

}}
              >
                <span className=

>üîç</span>
                <input
                  type=

placeholder=

value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className=

/>
              </div>
              {/* Category */}
              <div
                className=

style={{ flex:

}}
              >
                <select
                  value={categoryFilter}
                  onChange={(e) => setCategoryFilter(e.target.value)}
                  className=

aria-label=

>
                  <option value=

>All Categories</option>
                  {categories.map((c) => (
                    <option key={c} value={c}>
                      {c}
                    </option>
                  ))}
                </select>
                <span className=

aria-hidden=

/>
              </div>
              {/* Attendee thresholds (pills reuse fee toggle styling) */}
              <div
                className=

aria-label=

data-count=

style={{ minWidth:

}}
              >
                {[
                  { label:

},
                  { label:

},
                  { label:

},
                  { label:

},
                ].map((pill, idx) => (
                  <button
                    key={pill.val ||

}
                    type=

data-active={minAttendees === pill.val}
                    onClick={() => setMinAttendees(pill.val)}
                  >
                    {pill.label}
                  </button>
                ))}
                <span
                  className=

:
                      minAttendees ===

? 1
                        : minAttendees ===

? 2
                        : minAttendees ===

? 3
                        : 0,
                    width:

,
                  }}
                />
              </div>
              {/* Sort controls */}
              <div
                className=

style={{ display:

}}
              >
                <select
                  className=

value={sortOption}
                  onChange={(e) => setSortOption(e.target.value)}
                  aria-label=

>
                  <option value=

>NEW</option>
                  <option value=

>ATTENDEES</option>
                </select>
                <button
                  type=

onClick={() =>
                    setSortDir((d) => (d ===

))
                  }
                  title={`Toggle sort direction (${
                    sortDir ===

Toggle sort direction

}
                </button>
              </div>
              {(searchQuery ||
                categoryFilter ||
                minAttendees !==

||
                sortOption !==

||
                sortDir !==

) && (
                <button
                  className=

style={{ marginLeft:

}}
                  onClick={() => {
                    setSearchQuery(

);
                    setCategoryFilter(

);
                    setMinAttendees(

);
                    setSortOption(

);
                    setSortDir(

);
                  }}
                >
                  Reset
                </button>
              )}
            </div>
          </div>
        </header>

        <section style={{ marginTop:

}}>
          {loading && <div className=

>Loading...</div>}
          {error && (
            <div
              className=

style={{ color:

}}
            >
              {error}
            </div>
          )}

          <div className=

style={{ marginTop:

}}>
            <div className=

>
              <div
                className=

style={{
                  fontSize:

,
                  textTransform:

,
                  fontWeight: 700,
                }}
              >
                Events
              </div>
              <div style={{ fontSize:

, fontWeight: 700 }}>
                {stats.total}
              </div>
            </div>
            <div className=

>
              <div
                className=

style={{
                  fontSize:

,
                  textTransform:

,
                  fontWeight: 700,
                }}
              >
                Upcoming
              </div>
              <div style={{ fontSize:

, fontWeight: 700 }}>
                {stats.upcoming}
              </div>
            </div>
            <div className=

>
              <div
                className=

style={{
                  fontSize:

,
                  textTransform:

,
                  fontWeight: 700,
                }}
              >
                Attendees
              </div>
              <div style={{ fontSize:

, fontWeight: 700 }}>
                {stats.attendees}
              </div>
            </div>
          </div>

          <section style={{ marginTop:

}}>
            <h2 style={{ marginBottom:

}}>Your Events</h2>
            {filteredEvents.length === 0 && !loading ? (
              <div className=

>
                You haven

}}>
                <table
                  className=

style={{ width:

, borderCollapse:

}}
                >
                  <thead>
                    <tr
                      style={{
                        textAlign:

,
                        borderBottom:

,
                      }}
                    >
                      <th style={{ padding:

}}>Title</th>
                      <th style={{ padding:

}}>Date</th>
                      <th style={{ padding:

}}>Location</th>
                      <th style={{ padding:

}}>Attendees</th>
                      <th style={{ padding:

}}>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {loading &&
                      [...Array(3)].map((_, idx) => (
                        <tr key={

+ idx} className=

>
                          <td colSpan={5}>
                            <div className=

/>
                          </td>
                        </tr>
                      ))}
                    {!loading &&
                      filteredEvents
                        .slice(
                          currentPage * perPage,
                          (currentPage + 1) * perPage
                        )
                        .map((ev) => (
                          <tr
                            key={ev._id}
                            style={{
                              borderBottom:

,
                            }}
                          >
                            <td
                              style={{ padding:

}} // hand icon
                              onClick={() => eventAttendee(ev._id)}
                            >
                              {ev.title}
                            </td>
                            <td style={{ padding:

}}>
                              {new Date(ev.date).toLocaleString()}
                            </td>
                            <td style={{ padding:

}}>{ev.location}</td>
                            <td style={{ padding:

}}>
                              {ev.attendees ?? 0}
                            </td>
                            <td style={{ padding:

}}>
                              <div className=

>
                                <a
                                  href={`/events/${ev._id}/edit`}
                                  className=

>
                                  <FaEdit style={{ marginRight: 8 }} />
                                  <span>edit</span>
                                </a>
                                <button
                                  className=

onClick={() => handleDelete(ev._id)}
                                  title=

>
                                  <FaTrash style={{ marginRight: 8 }} />
                                  <span>delete</span>
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                  </tbody>
                </table>
                {/* pagination controls */}
                {filteredEvents.length > perPage && (
                  <div className=

>
                    <div className=

>
                      <label>
                        Show
                        <select
                          value={perPage}
                          onChange={(e) => {
                            setPerPage(Number(e.target.value));
                            setCurrentPage(0);
                          }}
                        >
                          {[6, 10, 15, 20].map((v) => (
                            <option key={v} value={v}>
                              {v}
                            </option>
                          ))}
                        </select>
                      </label>
                    </div>
                    <button
                      className=

onClick={() => setCurrentPage((p) => Math.max(0, p - 1))}
                      disabled={currentPage === 0}
                    >
                      <FaChevronLeft /> Prev
                    </button>
                    <div className=

>
                      {Array.from({
                        length: Math.ceil(filteredEvents.length / perPage),
                      }).map((_, i) => (
                        <button
                          key={i}
                          className={

+ (i === currentPage ?

)
                          }
                          onClick={() => setCurrentPage(i)}
                        >
                          {i + 1}
                        </button>
                      ))}
                    </div>
                    <div className=

>
                      Page {currentPage + 1} /{

}
                      {Math.ceil(filteredEvents.length / perPage)}
                    </div>
                    <button
                      className=

onClick={() =>
                        setCurrentPage((p) =>
                          Math.min(
                            Math.ceil(filteredEvents.length / perPage) - 1,
                            p + 1
                          )
                        )
                      }
                      disabled={
                        currentPage >=
                        Math.ceil(filteredEvents.length / perPage) - 1
                      }
                    >
                      Next <FaChevronRight />
                    </button>
                  </div>
                )}
              </div>
            )}
          </section>
        </section>
      </main>
      <Footer />

      {/* Delete confirmation modal */}
      {showDeleteModal && (
        <div className=

aria-modal=

>
          <div className=

>
            <h3>Confirm delete</h3>
            <p>
              Are you sure you want to delete this event? This action cannot be
              undone.
            </p>
            <div
              style={{
                display:

,
                gap: 8,
                justifyContent:

,
                marginTop: 12,
              }}
            >
              <button
                className=

onClick={cancelDelete}
                disabled={deleteLoading}
              >
                Cancel
              </button>
              <button
                className=

onClick={confirmDelete}
                disabled={deleteLoading}
              >
                {deleteLoading ?